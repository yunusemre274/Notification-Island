<UserControl x:Class="NI.Views.IslandView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:NI.ViewModels"
             xmlns:controls="clr-namespace:NI.Views.Controls"
             MouseEnter="OnMouseEnter"
             MouseLeave="OnMouseLeave"
             MouseLeftButtonDown="OnLeftClick"
             MouseRightButtonDown="OnRightClick">

    <UserControl.DataContext>
        <vm:IslandVM />
    </UserControl.DataContext>

    <UserControl.Resources>
        <!-- Premium background with gradient -->
        <LinearGradientBrush x:Key="IslandBackground" StartPoint="0,0" EndPoint="0,1">
            <GradientStop Color="#DD0A0A0A" Offset="0"/>
            <GradientStop Color="#EE000000" Offset="1"/>
        </LinearGradientBrush>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>

        <!-- Spotify green -->
        <SolidColorBrush x:Key="SpotifyGreen" Color="#1DB954"/>
        <SolidColorBrush x:Key="ProgressTrack" Color="#2A2A2A"/>
        
        <!-- Custom WiFi Icon (filled, pure white) -->
        <DrawingImage x:Key="WifiIcon">
            <DrawingImage.Drawing>
                <GeometryDrawing Brush="White">
                    <GeometryDrawing.Geometry>
                        <PathGeometry Figures="M12,2C7.58,2 3.77,4.09 1.25,7.35L12,21L22.75,7.35C20.23,4.09 16.42,2 12,2Z"/>
                    </GeometryDrawing.Geometry>
                </GeometryDrawing>
            </DrawingImage.Drawing>
        </DrawingImage>
        
        <!-- Custom Sound Icon (filled speaker + waves, pure white) -->
        <DrawingImage x:Key="SoundIcon">
            <DrawingImage.Drawing>
                <GeometryDrawing Brush="White">
                    <GeometryDrawing.Geometry>
                        <PathGeometry Figures="M3,9V15H7L12,20V4L7,9H3M16.5,12C16.5,10.23 15.48,8.71 14,7.97V16.02C15.48,15.29 16.5,13.77 16.5,12M14,3.23V5.29C16.89,6.15 19,8.83 19,12C19,15.17 16.89,17.85 14,18.71V20.77C18.01,19.86 21,16.28 21,12C21,7.72 18.01,4.14 14,3.23Z"/>
                    </GeometryDrawing.Geometry>
                </GeometryDrawing>
            </DrawingImage.Drawing>
        </DrawingImage>
        
        <!-- Spotify Logo Path (simplified circle with arcs) -->
        <DrawingImage x:Key="SpotifyLogo">
            <DrawingImage.Drawing>
                <DrawingGroup>
                    <!-- Circle background -->
                    <GeometryDrawing Brush="#1DB954">
                        <GeometryDrawing.Geometry>
                            <EllipseGeometry Center="12,12" RadiusX="12" RadiusY="12"/>
                        </GeometryDrawing.Geometry>
                    </GeometryDrawing>
                    <!-- Sound waves (3 arcs) -->
                    <GeometryDrawing Brush="Black">
                        <GeometryDrawing.Geometry>
                            <PathGeometry Figures="M17.9,10.9C14.7,9.1 9.3,8.8 5.8,9.9C5.3,10.1 4.7,9.8 4.5,9.3C4.3,8.8 4.6,8.2 5.1,8C9.2,6.7 15.2,7.1 19,9.2C19.5,9.5 19.6,10.1 19.4,10.5C19.1,11 18.5,11.2 17.9,10.9M17.8,13.7C17.5,14.1 17,14.2 16.6,13.9C14,12.4 9.9,11.9 6.6,13C6.1,13.2 5.6,12.9 5.4,12.4C5.2,11.9 5.5,11.4 6,11.2C9.8,10 14.4,10.5 17.4,12.2C17.8,12.5 17.9,13.1 17.8,13.7M16.4,16.5C16.2,16.8 15.8,16.9 15.5,16.7C13.2,15.4 10.3,15 6.7,15.8C6.3,15.9 5.9,15.6 5.8,15.2C5.7,14.8 6,14.4 6.4,14.3C10.4,13.4 13.6,13.9 16.2,15.3C16.5,15.5 16.6,16 16.4,16.5"/>
                        </GeometryDrawing.Geometry>
                    </GeometryDrawing>
                </DrawingGroup>
            </DrawingImage.Drawing>
        </DrawingImage>
        
        <!-- Headphone Icon (AirPods style) -->
        <DrawingImage x:Key="HeadphoneIcon">
            <DrawingImage.Drawing>
                <GeometryDrawing Brush="White">
                    <GeometryDrawing.Geometry>
                        <PathGeometry Figures="M12,1C7,1 3,5 3,10V17A3,3 0 0,0 6,20H9V12H5V10A7,7 0 0,1 12,3A7,7 0 0,1 19,10V12H15V20H18A3,3 0 0,0 21,17V10C21,5 17,1 12,1Z"/>
                    </GeometryDrawing.Geometry>
                </GeometryDrawing>
            </DrawingImage.Drawing>
        </DrawingImage>
        
        <!-- Active Window Icons -->
        <DrawingImage x:Key="BrowserIcon">
            <DrawingImage.Drawing>
                <GeometryDrawing Brush="White">
                    <GeometryDrawing.Geometry>
                        <PathGeometry Figures="M16.36,14C16.44,13.34 16.5,12.68 16.5,12C16.5,11.32 16.44,10.66 16.36,10H19.74C19.9,10.64 20,11.31 20,12C20,12.69 19.9,13.36 19.74,14M14.59,19.56C15.19,18.45 15.65,17.25 15.97,16H18.92C17.96,17.65 16.43,18.93 14.59,19.56M14.34,14H9.66C9.56,13.34 9.5,12.68 9.5,12C9.5,11.32 9.56,10.65 9.66,10H14.34C14.43,10.65 14.5,11.32 14.5,12C14.5,12.68 14.43,13.34 14.34,14M12,19.96C11.17,18.76 10.5,17.43 10.09,16H13.91C13.5,17.43 12.83,18.76 12,19.96M8,8H5.08C6.03,6.34 7.57,5.06 9.4,4.44C8.8,5.55 8.35,6.75 8,8M5.08,16H8C8.35,17.25 8.8,18.45 9.4,19.56C7.57,18.93 6.03,17.65 5.08,16M4.26,14C4.1,13.36 4,12.69 4,12C4,11.31 4.1,10.64 4.26,10H7.64C7.56,10.66 7.5,11.32 7.5,12C7.5,12.68 7.56,13.34 7.64,14M12,4.03C12.83,5.23 13.5,6.57 13.91,8H10.09C10.5,6.57 11.17,5.23 12,4.03M18.92,8H15.97C15.65,6.75 15.19,5.55 14.59,4.44C16.43,5.07 17.96,6.34 18.92,8M12,2C6.47,2 2,6.5 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"/>
                    </GeometryDrawing.Geometry>
                </GeometryDrawing>
            </DrawingImage.Drawing>
        </DrawingImage>
        
        <DrawingImage x:Key="FolderIcon">
            <DrawingImage.Drawing>
                <GeometryDrawing Brush="White">
                    <GeometryDrawing.Geometry>
                        <PathGeometry Figures="M10,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V8C22,6.89 21.1,6 20,6H12L10,4Z"/>
                    </GeometryDrawing.Geometry>
                </GeometryDrawing>
            </DrawingImage.Drawing>
        </DrawingImage>
        
        <DrawingImage x:Key="CodeIcon">
            <DrawingImage.Drawing>
                <GeometryDrawing Brush="White">
                    <GeometryDrawing.Geometry>
                        <PathGeometry Figures="M8,3A2,2 0 0,0 6,5V9A2,2 0 0,1 4,11H3V13H4A2,2 0 0,1 6,15V19A2,2 0 0,0 8,21H10V19H8V14A2,2 0 0,0 6,12A2,2 0 0,0 8,10V5H10V3M16,3A2,2 0 0,1 18,5V9A2,2 0 0,0 20,11H21V13H20A2,2 0 0,0 18,15V19A2,2 0 0,1 16,21H14V19H16V14A2,2 0 0,1 18,12A2,2 0 0,1 16,10V5H14V3H16Z"/>
                    </GeometryDrawing.Geometry>
                </GeometryDrawing>
            </DrawingImage.Drawing>
        </DrawingImage>
        
        <DrawingImage x:Key="MusicIcon">
            <DrawingImage.Drawing>
                <GeometryDrawing Brush="White">
                    <GeometryDrawing.Geometry>
                        <PathGeometry Figures="M21,3V15.5A3.5,3.5 0 0,1 17.5,19A3.5,3.5 0 0,1 14,15.5A3.5,3.5 0 0,1 17.5,12C18.04,12 18.55,12.12 19,12.34V6.47L9,8.6V17.5A3.5,3.5 0 0,1 5.5,21A3.5,3.5 0 0,1 2,17.5A3.5,3.5 0 0,1 5.5,14C6.04,14 6.55,14.12 7,14.34V6L21,3Z"/>
                    </GeometryDrawing.Geometry>
                </GeometryDrawing>
            </DrawingImage.Drawing>
        </DrawingImage>
        
        <DrawingImage x:Key="ChatIcon">
            <DrawingImage.Drawing>
                <GeometryDrawing Brush="White">
                    <GeometryDrawing.Geometry>
                        <PathGeometry Figures="M12,3C6.5,3 2,6.58 2,11C2.05,13.15 3.06,15.17 4.75,16.5C4.75,17.1 4.33,18.67 2,21C4.37,20.89 6.64,20 8.47,18.5C9.61,18.83 10.81,19 12,19C17.5,19 22,15.42 22,11C22,6.58 17.5,3 12,3Z"/>
                    </GeometryDrawing.Geometry>
                </GeometryDrawing>
            </DrawingImage.Drawing>
        </DrawingImage>
        
        <DrawingImage x:Key="GameIcon">
            <DrawingImage.Drawing>
                <GeometryDrawing Brush="White">
                    <GeometryDrawing.Geometry>
                        <PathGeometry Figures="M7.97,16L5,19C4.67,19.3 4.23,19.5 3.75,19.5A1.75,1.75 0 0,1 2,17.75V17.5L3,10.12C3.21,7.81 5.14,6 7.5,6H16.5C18.86,6 20.79,7.81 21,10.12L22,17.5V17.75A1.75,1.75 0 0,1 20.25,19.5C19.77,19.5 19.33,19.3 19,19L16.03,16H7.97M7,8V10H5V11H7V13H8V11H10V10H8V8H7M16.5,8A0.75,0.75 0 0,0 15.75,8.75A0.75,0.75 0 0,0 16.5,9.5A0.75,0.75 0 0,0 17.25,8.75A0.75,0.75 0 0,0 16.5,8M14.75,9.75A0.75,0.75 0 0,0 14,10.5A0.75,0.75 0 0,0 14.75,11.25A0.75,0.75 0 0,0 15.5,10.5A0.75,0.75 0 0,0 14.75,9.75M18.25,9.75A0.75,0.75 0 0,0 17.5,10.5A0.75,0.75 0 0,0 18.25,11.25A0.75,0.75 0 0,0 19,10.5A0.75,0.75 0 0,0 18.25,9.75M16.5,11.5A0.75,0.75 0 0,0 15.75,12.25A0.75,0.75 0 0,0 16.5,13A0.75,0.75 0 0,0 17.25,12.25A0.75,0.75 0 0,0 16.5,11.5Z"/>
                    </GeometryDrawing.Geometry>
                </GeometryDrawing>
            </DrawingImage.Drawing>
        </DrawingImage>
        
        <DrawingImage x:Key="DocumentIcon">
            <DrawingImage.Drawing>
                <GeometryDrawing Brush="White">
                    <GeometryDrawing.Geometry>
                        <PathGeometry Figures="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                    </GeometryDrawing.Geometry>
                </GeometryDrawing>
            </DrawingImage.Drawing>
        </DrawingImage>
        
        <DrawingImage x:Key="SystemIcon">
            <DrawingImage.Drawing>
                <GeometryDrawing Brush="White">
                    <GeometryDrawing.Geometry>
                        <PathGeometry Figures="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.67 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z"/>
                    </GeometryDrawing.Geometry>
                </GeometryDrawing>
            </DrawingImage.Drawing>
        </DrawingImage>
        
        <DrawingImage x:Key="AppIcon">
            <DrawingImage.Drawing>
                <GeometryDrawing Brush="White">
                    <GeometryDrawing.Geometry>
                        <PathGeometry Figures="M4,4H8V8H4V4M10,4H14V8H10V4M16,4H20V8H16V4M4,10H8V14H4V10M10,10H14V14H10V10M16,10H20V14H16V10M4,16H8V20H4V16M10,16H14V20H10V16M16,16H20V20H16V16Z"/>
                    </GeometryDrawing.Geometry>
                </GeometryDrawing>
            </DrawingImage.Drawing>
        </DrawingImage>
        
        <DrawingImage x:Key="DesktopIcon">
            <DrawingImage.Drawing>
                <GeometryDrawing Brush="White">
                    <GeometryDrawing.Geometry>
                        <PathGeometry Figures="M21,16H3V4H21M21,2H3C1.89,2 1,2.89 1,4V16A2,2 0 0,0 3,18H10V20H8V22H16V20H14V18H21A2,2 0 0,0 23,16V4C23,2.89 22.1,2 21,2Z"/>
                    </GeometryDrawing.Geometry>
                </GeometryDrawing>
            </DrawingImage.Drawing>
        </DrawingImage>
        
        <!-- PHASE 3: Premium iOS-style progress bar (NO GLOW - pure black) -->
        <Style x:Key="SpotifyProgressBar" TargetType="ProgressBar">
            <Setter Property="Height" Value="3"/>
            <Setter Property="Background" Value="#20FFFFFF"/>
            <Setter Property="Foreground" Value="{StaticResource SpotifyGreen}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ProgressBar">
                        <Border Background="{TemplateBinding Background}" CornerRadius="2">
                            <Border x:Name="PART_Track" CornerRadius="2">
                                <Border x:Name="PART_Indicator"
                                        Background="{TemplateBinding Foreground}"
                                        CornerRadius="2"
                                        HorizontalAlignment="Left"/>
                            </Border>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <Grid x:Name="RootGrid">
        <!-- CANVAS SPEC: Main Island Pill (420x48px, radius 24px) -->
        <Border x:Name="IslandBorder"
                Width="420" Height="48"
                CornerRadius="24"
                Background="#000000"
                HorizontalAlignment="Center"
                VerticalAlignment="Top"
                Panel.ZIndex="5000"
                RenderTransformOrigin="0.5,0.5">
            <Border.Effect>
                <!-- CANVAS SPEC: Shadow 0px 6px 20px rgba(0,0,0,0.35) -->
                <DropShadowEffect Color="#000000"
                                  BlurRadius="20"
                                  Opacity="0.35"
                                  ShadowDepth="6"
                                  Direction="270"/>
            </Border.Effect>
            <Border.RenderTransform>
                <TransformGroup>
                    <ScaleTransform x:Name="IslandScale" ScaleX="1" ScaleY="1"/>
                </TransformGroup>
            </Border.RenderTransform>

            <!-- CANVAS SPEC: Horizontal padding 16px, Vertical padding 8px -->
            <Grid Margin="16,8">
                <!-- CANVAS SPEC: IDLE MODE (420x48px) -->
                <Grid x:Name="IdleContent"
                      Visibility="{Binding IsIdle, RelativeSource={RelativeSource AncestorType=UserControl}, Converter={StaticResource BoolToVis}}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>   <!-- Time + Dot -->
                        <ColumnDefinition Width="8"/>      <!-- Spacer -->
                        <ColumnDefinition Width="*"/>      <!-- Search Bar -->
                        <ColumnDefinition Width="8"/>      <!-- Spacer -->
                        <ColumnDefinition Width="Auto"/>   <!-- Weather -->
                    </Grid.ColumnDefinitions>

                    <!-- CANVAS SPEC: LEFT - Time + Green Dot -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                        <!-- CANVAS SPEC: Time text 14px, medium weight -->
                        <TextBlock x:Name="ClockText"
                                   Text="{Binding ClockText}"
                                   FontFamily="Segoe UI"
                                   FontSize="14"
                                   FontWeight="Medium"
                                   Foreground="#FFFFFF"
                                   VerticalAlignment="Center"
                                   Margin="0,0,6,0"/>

                        <!-- CANVAS SPEC: Status dot 8px circle -->
                        <Ellipse Width="8" Height="8"
                                 Fill="#1DB954"
                                 VerticalAlignment="Center">
                            <Ellipse.Effect>
                                <DropShadowEffect Color="#1DB954"
                                                  BlurRadius="4"
                                                  Opacity="0.6"
                                                  ShadowDepth="0"/>
                            </Ellipse.Effect>
                        </Ellipse>
                    </StackPanel>

                    <!-- CANVAS SPEC: CENTER - Search Bar (height 32px, radius 16px) -->
                    <Border Grid.Column="2"
                            Background="#15FFFFFF"
                            CornerRadius="16"
                            Height="32"
                            VerticalAlignment="Center">
                        <TextBox x:Name="SearchTextBox"
                                 FontFamily="Segoe UI"
                                 FontSize="13"
                                 FontWeight="Normal"
                                 Foreground="#FFFFFF"
                                 Background="Transparent"
                                 BorderThickness="0"
                                 VerticalAlignment="Center"
                                 VerticalContentAlignment="Center"
                                 Padding="16,0"
                                 CaretBrush="#FFFFFF"
                                 KeyDown="OnSearchKeyDown">
                            <TextBox.Style>
                                <Style TargetType="TextBox">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="TextBox">
                                                <Grid>
                                                    <ScrollViewer x:Name="PART_ContentHost"
                                                                  VerticalAlignment="Center"/>
                                                    <TextBlock Text="Search or ask..."
                                                               FontFamily="Segoe UI"
                                                               FontSize="13"
                                                               Foreground="#80FFFFFF"
                                                               VerticalAlignment="Center"
                                                               Margin="16,0"
                                                               IsHitTestVisible="False">
                                                        <TextBlock.Style>
                                                            <Style TargetType="TextBlock">
                                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding Text, RelativeSource={RelativeSource TemplatedParent}}" Value="">
                                                                        <Setter Property="Visibility" Value="Visible"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </TextBlock.Style>
                                                    </TextBlock>
                                                </Grid>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </TextBox.Style>
                        </TextBox>
                    </Border>

                    <!-- CANVAS SPEC: RIGHT - Temperature + Weather Icon -->
                    <StackPanel Grid.Column="4"
                                Orientation="Horizontal"
                                VerticalAlignment="Center">
                        <!-- CANVAS SPEC: Temperature text 14px -->
                        <TextBlock Text="{Binding WeatherTemp}"
                                   FontFamily="Segoe UI"
                                   FontSize="14"
                                   FontWeight="Medium"
                                   Foreground="#FFFFFF"
                                   VerticalAlignment="Center"
                                   Margin="0,0,4,0"/>
                        <!-- CANVAS SPEC: Weather icon size 18px -->
                        <TextBlock Text="{Binding WeatherIcon}"
                                   FontSize="18"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                </Grid>

                <!-- PHASE 2: NOTIFICATION MODE - App Logo + "1 new notification" -->
                <Grid x:Name="NotificationContent"
                      Visibility="{Binding IsNotification, RelativeSource={RelativeSource AncestorType=UserControl}, Converter={StaticResource BoolToVis}}">
                    <StackPanel Orientation="Horizontal"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center">
                        <!-- App Icon/Logo -->
                        <Image x:Name="NotificationAppIcon"
                               Width="20"
                               Height="20"
                               Source="{Binding AppIcon}"
                               Margin="0,0,10,0"
                               VerticalAlignment="Center">
                            <Image.Effect>
                                <DropShadowEffect Color="#FFFFFF"
                                                  BlurRadius="8"
                                                  Opacity="0.3"
                                                  ShadowDepth="0"/>
                            </Image.Effect>
                        </Image>

                        <!-- Notification Text -->
                        <TextBlock x:Name="NotificationText"
                                   Text="{Binding CompactText}"
                                   FontFamily="Segoe UI"
                                   FontSize="12"
                                   FontWeight="Medium"
                                   Foreground="#FFFFFF"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                </Grid>

                <!-- PHASE 3: SPOTIFY PILL MODE - Logo + Track info (compact) -->
                <Grid x:Name="SpotifyPillContent"
                      Visibility="{Binding IsSpotifyPill, RelativeSource={RelativeSource AncestorType=UserControl}, Converter={StaticResource BoolToVis}}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>   <!-- Logo -->
                        <ColumnDefinition Width="8"/>      <!-- Spacer -->
                        <ColumnDefinition Width="*"/>      <!-- Track Info -->
                        <ColumnDefinition Width="8"/>      <!-- Spacer -->
                        <ColumnDefinition Width="Auto"/>   <!-- Waveform -->
                    </Grid.ColumnDefinitions>

                    <!-- Spotify Logo (PHASE 3: No glow - pure black design) -->
                    <Image Grid.Column="0"
                           Width="18"
                           Height="18"
                           Source="{StaticResource SpotifyLogo}"
                           VerticalAlignment="Center"/>

                    <!-- Track Info (centered) -->
                    <StackPanel Grid.Column="2"
                                VerticalAlignment="Center"
                                HorizontalAlignment="Center">
                        <!-- Track Title -->
                        <TextBlock Text="{Binding SpotifySong}"
                                   FontFamily="Segoe UI"
                                   FontSize="12"
                                   FontWeight="SemiBold"
                                   Foreground="#FFFFFF"
                                   TextTrimming="CharacterEllipsis"
                                   MaxWidth="200"
                                   HorizontalAlignment="Center"/>
                        <!-- Artist -->
                        <TextBlock Text="{Binding SpotifyArtist}"
                                   FontFamily="Segoe UI"
                                   FontSize="10"
                                   FontWeight="Normal"
                                   Foreground="#B3FFFFFF"
                                   TextTrimming="CharacterEllipsis"
                                   MaxWidth="200"
                                   HorizontalAlignment="Center"
                                   Margin="0,2,0,0"/>
                    </StackPanel>

                    <!-- CANVAS SPEC: Waveform (height 16px max, spacing 2px) -->
                    <StackPanel Grid.Column="4"
                                Orientation="Horizontal"
                                VerticalAlignment="Center">
                        <Rectangle Width="2" Height="10" Fill="#1DB954" RadiusX="1" RadiusY="1" Opacity="0.8" Margin="0,0,2,0"/>
                        <Rectangle Width="2" Height="16" Fill="#1DB954" RadiusX="1" RadiusY="1" Opacity="0.9" Margin="0,0,2,0"/>
                        <Rectangle Width="2" Height="8" Fill="#1DB954" RadiusX="1" RadiusY="1" Opacity="0.7" Margin="0,0,2,0"/>
                        <Rectangle Width="2" Height="14" Fill="#1DB954" RadiusX="1" RadiusY="1" Opacity="0.8"/>
                    </StackPanel>
                </Grid>

                <!-- CANVAS SPEC: Spotify Expanded (380x140px, radius 28px) -->
                <Grid x:Name="SpotifyExpandedContent"
                      Visibility="{Binding IsSpotifyExpanded, RelativeSource={RelativeSource AncestorType=UserControl}, Converter={StaticResource BoolToVis}}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>  <!-- Main content -->
                        <RowDefinition Height="Auto"/>  <!-- Progress bar -->
                    </Grid.RowDefinitions>

                    <Grid Grid.Row="0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>  <!-- Album Art -->
                            <ColumnDefinition Width="*"/>     <!-- Track Info -->
                            <ColumnDefinition Width="Auto"/>  <!-- Controls -->
                        </Grid.ColumnDefinitions>

                        <!-- CANVAS SPEC: Album Art (56x56px, radius 12px) -->
                        <Border Grid.Column="0" Width="56" Height="56" CornerRadius="12"
                                Background="#1A1A1A" Margin="0,0,12,0">
                            <Border.Effect>
                                <DropShadowEffect Color="#000000" BlurRadius="12" Opacity="0.4" ShadowDepth="2"/>
                            </Border.Effect>
                            <Image x:Name="AlbumArtImage"
                                   Source="{Binding AlbumArtwork}"
                                   Stretch="UniformToFill">
                                <Image.Clip>
                                    <RectangleGeometry Rect="0,0,56,56" RadiusX="12" RadiusY="12"/>
                                </Image.Clip>
                            </Image>
                        </Border>

                        <!-- Track Info -->
                        <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="0,0,8,0">
                            <!-- Spotify Logo (minimal) -->
                            <Image Width="10" Height="10" Source="{StaticResource SpotifyLogo}"
                                   HorizontalAlignment="Left" Margin="0,0,0,6"
                                   Opacity="0.6"/>

                            <!-- CANVAS SPEC: Track Title (15px, semibold) -->
                            <TextBlock Text="{Binding SpotifySong}"
                                       FontWeight="SemiBold" FontSize="15"
                                       Foreground="#FFFFFF"
                                       TextTrimming="CharacterEllipsis"
                                       MaxWidth="180"/>

                            <!-- CANVAS SPEC: Artist (13px, opacity 0.75) -->
                            <TextBlock Text="{Binding SpotifyArtist}"
                                       FontSize="13"
                                       Foreground="#FFFFFF"
                                       Opacity="0.75"
                                       TextTrimming="CharacterEllipsis"
                                       MaxWidth="180"
                                       Margin="0,3,0,0"/>
                        </StackPanel>

                        <!-- CANVAS SPEC: Media Controls (28x28px) -->
                        <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">

                            <!-- CANVAS SPEC: Previous Button (28x28px) -->
                            <Border Width="28" Height="28" Background="#1A1A1A" CornerRadius="14"
                                    Cursor="Hand" MouseLeftButtonDown="OnSkipPrevious"
                                    Margin="0,0,6,0" Opacity="0.85">
                                <Border.Effect>
                                    <DropShadowEffect Color="#000000" BlurRadius="8" Opacity="0.3" ShadowDepth="1"/>
                                </Border.Effect>
                                <Path Fill="#CCFFFFFF" Stretch="Uniform" Width="12" Height="12"
                                      Data="M6,18V6H8V18H6M9.5,12L18,6V18L9.5,12Z"
                                      HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>

                            <!-- CANVAS SPEC: Play/Pause Button (28x28px, NO glow) -->
                            <Border Width="28" Height="28" Background="#1DB954" CornerRadius="14"
                                    Cursor="Hand" MouseLeftButtonDown="OnTogglePlayPause"
                                    Margin="0,0,6,0">
                                <Border.Effect>
                                    <DropShadowEffect Color="#000000" BlurRadius="8" Opacity="0.4" ShadowDepth="2"/>
                                </Border.Effect>
                                <Path x:Name="PlayPauseIcon" Fill="White" Stretch="Uniform" Width="12" Height="12"
                                      HorizontalAlignment="Center" VerticalAlignment="Center">
                                    <Path.Style>
                                        <Style TargetType="Path">
                                            <Setter Property="Data" Value="M8,5.14V19.14L19,12.14L8,5.14Z"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsSpotifyPlaying}" Value="True">
                                                    <Setter Property="Data" Value="M14,19H18V5H14M6,19H10V5H6V19Z"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Path.Style>
                                </Path>
                            </Border>

                            <!-- CANVAS SPEC: Next Button (28x28px) -->
                            <Border Width="28" Height="28" Background="#1A1A1A" CornerRadius="14"
                                    Cursor="Hand" MouseLeftButtonDown="OnSkipNext"
                                    Opacity="0.85">
                                <Border.Effect>
                                    <DropShadowEffect Color="#000000" BlurRadius="8" Opacity="0.3" ShadowDepth="1"/>
                                </Border.Effect>
                                <Path Fill="#CCFFFFFF" Stretch="Uniform" Width="12" Height="12"
                                      Data="M16,18H18V6H16M6,18L14.5,12L6,6V18Z"
                                      HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                        </StackPanel>
                    </Grid>

                    <!-- Progress Bar Section (always visible when SpotifyExpanded) -->
                    <StackPanel Grid.Row="1" Margin="0,10,0,0">

                        <!-- Progress Bar -->
                        <ProgressBar Value="{Binding ProgressPercentage, Mode=OneWay}"
                                     Maximum="100"
                                     Style="{StaticResource SpotifyProgressBar}"
                                     Margin="0,0,0,5"/>

                        <!-- Time Labels -->
                        <Grid>
                            <TextBlock Text="{Binding PositionText}"
                                       FontSize="9"
                                       FontWeight="Medium"
                                       Foreground="#80FFFFFF"
                                       HorizontalAlignment="Left"/>
                            <TextBlock Text="{Binding DurationText}"
                                       FontSize="9"
                                       FontWeight="Medium"
                                       Foreground="#80FFFFFF"
                                       HorizontalAlignment="Right"/>
                        </Grid>
                    </StackPanel>
                </Grid>

                <!-- PHASE 4: SEARCH ANSWER MODE - Large black card with Ollama response -->
                <Grid x:Name="SearchAnswerContent"
                      Visibility="{Binding IsSearchAnswer, RelativeSource={RelativeSource AncestorType=UserControl}, Converter={StaticResource BoolToVis}}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>  <!-- Header -->
                        <RowDefinition Height="*"/>     <!-- Answer text -->
                        <RowDefinition Height="Auto"/>  <!-- Close button -->
                    </Grid.RowDefinitions>

                    <!-- Header: Question -->
                    <StackPanel Grid.Row="0" Margin="0,0,0,12">
                        <TextBlock Text="ðŸ¤”"
                                   FontSize="20"
                                   HorizontalAlignment="Left"
                                   Margin="0,0,0,6"/>
                        <TextBlock x:Name="SearchQuestionText"
                                   Text="Your question"
                                   FontFamily="Segoe UI"
                                   FontSize="12"
                                   FontWeight="SemiBold"
                                   Foreground="#B3FFFFFF"
                                   TextWrapping="Wrap"
                                   MaxWidth="410"/>
                    </StackPanel>

                    <!-- Answer Text (scrollable) -->
                    <ScrollViewer Grid.Row="1"
                                  VerticalScrollBarVisibility="Auto"
                                  MaxHeight="140">
                        <TextBlock x:Name="SearchAnswerText"
                                   Text="Thinking..."
                                   FontFamily="Segoe UI"
                                   FontSize="13"
                                   FontWeight="Normal"
                                   Foreground="#FFFFFF"
                                   TextWrapping="Wrap"
                                   LineHeight="20"
                                   MaxWidth="410"/>
                    </ScrollViewer>

                    <!-- Close Button -->
                    <Border Grid.Row="2"
                            Background="#20FFFFFF"
                            CornerRadius="8"
                            Padding="12,6"
                            HorizontalAlignment="Right"
                            Margin="0,12,0,0"
                            Cursor="Hand"
                            MouseLeftButtonDown="OnCloseSearchAnswer">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ESC"
                                       FontFamily="Segoe UI"
                                       FontSize="10"
                                       FontWeight="SemiBold"
                                       Foreground="#80FFFFFF"
                                       VerticalAlignment="Center"
                                       Margin="0,0,6,0"/>
                            <TextBlock Text="Close"
                                       FontFamily="Segoe UI"
                                       FontSize="11"
                                       FontWeight="Medium"
                                       Foreground="#FFFFFF"
                                       VerticalAlignment="Center"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </Grid>
        </Border>

        <!-- Settings Popup -->
        <Popup x:Name="SettingsPopup" 
               Placement="Bottom" 
               PlacementTarget="{Binding ElementName=IslandBorder}"
               StaysOpen="False" 
               AllowsTransparency="True" 
               PopupAnimation="Fade">
            <Border Background="#E5000000" CornerRadius="12" Padding="16" Margin="8">
                <StackPanel Width="200">
                    <TextBlock Text="âš™ï¸ Settings" Foreground="White" FontWeight="Bold" 
                               FontSize="14" Margin="0,0,0,12"/>
                    
                    <CheckBox Content="Start with Windows" Foreground="White" FontSize="12"
                              IsChecked="{Binding AutostartEnabled}" Margin="0,4"/>
                    <CheckBox Content="Sound Effects" Foreground="White" FontSize="12"
                              IsChecked="{Binding SoundEnabled}" Margin="0,4"/>
                    
                    <Separator Margin="0,12,0,8" Background="#333"/>
                    
                    <TextBlock Text="ðŸŽ‚ Smart Cards" Foreground="#AAA" FontSize="11" Margin="0,0,0,6"/>
                    
                    <CheckBox Content="National Days (TR)" Foreground="White" FontSize="12"
                              IsChecked="{Binding ShowNationalEvents}" Margin="0,4"/>
                    <CheckBox Content="Global Days" Foreground="White" FontSize="12"
                              IsChecked="{Binding ShowGlobalEvents}" Margin="0,4"/>
                    <CheckBox Content="Idle Messages" Foreground="White" FontSize="12"
                              IsChecked="{Binding IdleMessagesEnabled}" Margin="0,4"/>
                    
                    <Separator Margin="0,12,0,12" Background="#333"/>
                    
                    <Button Content="Exit App" Click="OnExitClick" 
                            Background="#CC3333" Foreground="White" 
                            BorderThickness="0" Padding="10,6" Cursor="Hand"
                            HorizontalAlignment="Stretch"/>
                </StackPanel>
            </Border>
        </Popup>

        <!-- Quick Settings Panel Container (below island) -->
        <Grid x:Name="PanelContainer" 
              VerticalAlignment="Top" 
              HorizontalAlignment="Center"
              Margin="0,60,0,0"
              Visibility="Collapsed">
            <!-- Panels will be added dynamically -->
        </Grid>
    </Grid>
</UserControl>
